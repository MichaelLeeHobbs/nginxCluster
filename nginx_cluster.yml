---
- name: Install NGINX Cluster
  hosts: nginx-cluster
  remote_user: root
  # remote_user: user
  # sudo: yes

  roles:
    - common
    - nginx
    - pacemaker
  vars:
    pacemaker_ansible_group: nginx-cluster
    pacemaker_password: secret
    pacemaker_cluster_name: nginx_ha_cluster
    pacemaker_properties:
      stonith_enabled: "false"
      no-quorum-policy: "ignore"
    pacemaker_resources_delete: true
    pacemaker_resources:
      - id: vip230
        type: "ocf:heartbeat:IPaddr2"
        options:
          ip: 192.168.1.230
          cidr_netmask: 24
        op:
          - action: monitor
            options:
              interval: 5s
      - id: nginx
        type: "ocf:heartbeat:nginx"
        options:
          configfile: "/etc/nginx/nginx.conf"
          status10url: "http://localhost/nginx_status"
        op:
          - action: monitor
            options:
              interval: 5s
    pacemaker_constraints:
      - constraint: "colocation add nginx vip230 INFINITY"
      - constraint: "order vip230 then nginx"